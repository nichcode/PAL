name: Clang Format Check

on:
  pull_request:
  push:
    branches: [ master ]

jobs:
  clang-format:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Install clang-format
        run: |
          sudo apt-get update wget https://apt.llvm.org/llvm.sh
          chmod +x llvm.sh 21
          sudo apt-get install -y clang-format-21
          sudo ln -sf /usr/bin/clang-format-21 /usr/bin/clang-format

      - name: Make source files writable
        run: chmod -R u+w .

      - name: Check Formatting
        run: |
          files=$(git ls-files '*.c' '*.cpp' '*.h' '*.hpp')
          if [ -n "$files" ]; then
            clang-format --dry-run --Werror $files
          fi
